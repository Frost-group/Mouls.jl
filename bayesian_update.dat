======================================================================
Bayesian Coupling Matrix Update - Example Workflow
======================================================================

1. Load existing coupling table
CouplingTable (size 20×20)
    A     R     N     D     C     Q     E     G     H     I     L     K     M     F     P     S     T     W     Y     V     
A   0.959 0.950 0.954 0.975 0.971 0.950 0.957 0.990 0.950 0.940 0.972 0.968 0.975 0.991 0.970 0.986 0.963 0.975 0.971 0.970 
R   0.975 0.954 0.975 0.986 0.954 0.988 0.975 0.983 0.933 0.979 0.972 0.981 0.950 0.963 0.954 0.973 0.958 0.988 0.967 0.944 
N   1.000 0.975 0.957 0.971 1.000 0.988 0.982 0.989 0.950 1.000 1.000 0.974 0.986 0.971 0.992 0.981 0.958 0.975 0.978 0.983 
D   0.984 0.982 0.983 0.991 0.971 0.991 1.000 0.993 0.967 0.973 0.986 0.992 1.000 0.978 1.000 0.971 0.964 0.975 1.000 0.990 
C   0.967 0.985 0.992 1.000 0.988 0.980 0.980 0.933 1.000 0.975 0.986 0.982 0.950 0.983 0.971 0.967 0.956 0.950 0.967 0.983 
Q   0.958 0.956 0.971 0.967 0.975 0.942 0.975 0.990 0.933 0.950 0.978 0.980 1.000 0.971 0.971 0.964 0.965 0.960 0.975 0.958 
E   0.974 0.970 0.994 0.982 0.975 0.975 0.979 0.985 0.963 0.978 0.963 0.964 0.979 0.983 0.985 0.987 0.982 1.000 0.942 0.944 
G   0.992 0.953 0.981 0.981 0.981 0.982 0.975 0.983 0.944 0.973 0.983 0.986 1.000 1.000 0.983 0.973 0.961 0.900 0.978 0.979 
H   1.000 0.950 0.967 0.975 0.975 0.933 0.967 1.000 0.933 0.983 1.000 1.000 0.967 0.975 0.967 0.950 1.000 1.000 0.975 0.933 
I   1.000 0.932 0.970 0.965 1.000 0.953 0.980 0.986 0.975 0.975 0.977 0.986 0.960 0.950 0.962 0.993 0.955 1.000 0.989 0.950 
L   0.973 0.953 0.971 0.981 0.983 0.962 0.975 0.969 0.936 0.970 0.965 0.963 1.000 1.000 0.961 0.983 0.945 0.944 0.988 0.967 
K   0.976 0.969 0.968 1.000 0.988 0.964 0.973 0.970 0.938 0.950 0.978 0.963 0.980 0.986 0.983 0.987 0.959 0.983 0.968 0.936 
M   0.986 0.988 1.000 1.000 1.000 0.975 0.967 0.986 0.967 0.950 0.967 0.980 0.975 0.943 0.988 0.933 0.960 0.980 0.957 0.983 
F   0.982 0.957 0.978 0.992 0.988 0.980 0.971 0.972 0.900 0.900 0.990 0.988 1.000 0.960 0.925 0.986 0.975 1.000 0.950 0.950 
P   0.950 0.950 0.950 0.950 0.950 0.950 0.950 0.950 0.950 0.950 0.950 0.950 0.950 0.950 0.950 0.950 0.950 0.950 0.950 0.950 
S   0.983 0.962 0.958 0.988 0.986 0.974 0.984 0.991 0.975 0.971 0.987 0.969 0.975 0.980 0.989 0.977 0.960 0.957 0.963 0.975 
T   0.975 0.980 0.967 0.991 0.973 1.000 0.936 0.989 1.000 0.964 0.973 0.968 0.986 1.000 0.990 0.976 0.968 0.967 0.969 0.943 
W   1.000 0.983 0.980 0.967 1.000 0.967 0.975 1.000 0.960 0.950 0.980 1.000 0.950 0.950 0.960 1.000 0.900 1.000 1.000 1.000 
Y   0.989 0.993 0.973 0.987 0.971 0.955 0.986 0.982 1.000 0.986 0.976 0.990 1.000 0.980 0.986 0.979 0.936 0.967 0.980 0.980 
V   1.000 0.953 0.983 1.000 1.000 0.944 0.953 0.976 0.925 0.970 0.976 0.975 0.950 0.975 0.981 0.971 0.959 1.000 0.933 0.976 


2. Initialize Bayesian prior from coupling table
BayesianCouplingPrior (20×20 coupling matrix)
  Truncation probability (mean): 0.001
  Total prior strength (coupling): 100.0 equiv. observations per cell


Prior coupling probabilities (from raw experimental data):
CouplingTable (size 20×20)
    A     R     N     D     C     Q     E     G     H     I     L     K     M     F     P     S     T     W     Y     V     
A   0.588 0.500 0.533 0.727 0.688 0.500 0.565 0.875 0.500 0.417 0.710 0.667 0.667 0.846 0.688 0.839 0.611 0.667 0.688 0.667 
R   0.731 0.536 0.714 0.839 0.533 0.842 0.733 0.814 0.375 0.762 0.711 0.794 0.500 0.611 0.538 0.714 0.571 0.800 0.636 0.444 
N   0.917 0.722 0.562 0.684 0.889 0.842 0.789 0.857 0.500 0.889 0.941 0.714 0.778 0.667 0.867 0.783 0.571 0.667 0.727 0.786 
D   0.810 0.789 0.786 0.875 0.667 0.846 0.957 0.906 0.600 0.706 0.839 0.885 0.929 0.727 0.938 0.692 0.625 0.667 0.667 0.864 
C   0.600 0.800 0.867 0.857 0.800 0.714 0.750 0.400 0.833 0.667 0.812 0.789 0.950 0.750 0.688 0.643 0.556 0.500 0.625 0.786 
Q   0.571 0.556 0.688 0.643 0.667 0.429 0.722 0.864 0.375 0.500 0.759 0.714 0.667 0.667 0.684 0.625 0.636 0.571 0.700 0.571 
E   0.714 0.680 0.900 0.789 0.714 0.727 0.778 0.800 0.600 0.750 0.625 0.625 0.750 0.750 0.821 0.824 0.792 0.857 0.429 0.450 
G   0.893 0.528 0.783 0.793 0.783 0.769 0.727 0.806 0.455 0.706 0.800 0.839 0.900 0.889 0.812 0.714 0.600 0.333 0.759 0.769 
H   0.833 0.500 0.636 0.667 0.667 0.400 0.636 0.909 0.400 0.750 0.875 0.923 0.600 0.667 0.600 0.500 0.833 0.857 0.667 0.400 
I   0.933 0.333 0.667 0.640 0.875 0.529 0.750 0.812 0.667 0.700 0.733 0.826 0.571 0.500 0.600 0.882 0.538 0.800 0.857 0.500 
L   0.714 0.526 0.696 0.793 0.786 0.607 0.735 0.677 0.385 0.667 0.643 0.615 0.833 0.889 0.606 0.806 0.452 0.455 0.800 0.647 
K   0.742 0.677 0.667 0.938 0.833 0.615 0.719 0.680 0.400 0.500 0.763 0.622 0.750 0.778 0.806 0.850 0.579 0.750 0.667 0.385 
M   0.778 0.800 0.833 0.750 0.800 0.667 0.600 0.778 0.600 0.500 0.636 0.750 0.667 0.444 0.800 0.400 0.571 0.714 0.556 0.750 
F   0.769 0.556 0.727 0.857 0.800 0.714 0.667 0.700 0.333 0.167 0.864 0.800 0.833 0.571 0.333 0.812 0.667 0.800 0.500 0.500 
P   0.950 0.950 0.950 0.950 0.950 0.950 0.950 0.950 0.950 0.950 0.950 0.950 0.950 0.950 0.950 0.950 0.950 0.950 0.950 0.950 
S   0.816 0.609 0.571 0.857 0.812 0.714 0.824 0.882 0.700 0.688 0.848 0.679 0.700 0.765 0.862 0.756 0.593 0.556 0.600 0.727 
T   0.714 0.778 0.643 0.846 0.692 0.900 0.385 0.857 0.833 0.633 0.708 0.667 0.778 0.900 0.870 0.750 0.667 0.625 0.667 0.438 
W   0.889 0.750 0.714 0.600 0.667 0.625 0.667 0.857 0.583 0.500 0.714 0.800 0.950 0.950 0.571 0.833 0.250 0.833 0.800 0.750 
Y   0.818 0.882 0.706 0.824 0.667 0.538 0.812 0.769 0.857 0.778 0.737 0.864 0.857 0.714 0.778 0.750 0.385 0.600 0.750 0.765 
V   0.909 0.529 0.750 0.941 0.875 0.455 0.526 0.739 0.333 0.682 0.737 0.731 0.500 0.667 0.788 0.696 0.579 0.800 0.400 0.737 


3. Generate synthetic observations (simulating real synthesis data)
Using prior-based coupling probabilities for simulation consistency...

Synthetic Observation 1:
SynthesisObservation
  Target: MARLIN
  Total count: 500
  Unique sequences: 32
  Top 5 sequences:
    MARLIN: 63 (12.6%)
    MRLIN: 50 (10.0%)
    MRLN: 38 (7.6%)
    MLIN: 27 (5.4%)
    MRIN: 26 (5.2%)


Synthetic Observation 2:
SynthesisObservation
  Target: LIMPIT
  Total count: 500
  Unique sequences: 29
  Top 5 sequences:
    LIMPIT: 73 (14.6%)
    LIMPT: 64 (12.8%)
    LMPT: 61 (12.2%)
    LMPIT: 47 (9.4%)
    IMPIT: 41 (8.2%)


Synthetic Observation 3 (100% yield):
SynthesisObservation
  Target: AAAAAAAA
  Total count: 500
  Unique sequences: 1
  Top 1 sequences:
    AAAAAAAA: 500 (100.0%)

SynthesisObservation
  Target: CRANKYMEGAFISHSTINGRAY
  Total count: 500
  Unique sequences: 1
  Top 1 sequences:
    CRANKYMEGAFISHSTINGRAY: 500 (100.0%)


4. Update posterior using MAP estimation
This will run optimization to find parameters that best explain the observations...
Starting MAP estimation...
  Prior coupling mean: 0.71
  Prior truncation mean: 0.001
  Observations: 4
  Likelihood simulations per evaluation: 1000
  Optimization Results:
    Converged: false
    Iterations: 50 / 50
    Function evaluations: 2600
    Final objective value: 35030.78
    Final coupling mean: 0.703
    Final coupling std: 0.2278
    Final truncation prob: 0.001
    Coupling range: [0.001, 0.999]

Updated Posterior:
BayesianCouplingPrior (20×20 coupling matrix)
  Truncation probability (mean): 0.001
  Total prior strength (coupling): 100.0 equiv. observations per cell


5. Convert posterior back to coupling table for predictions

Updated Coupling Table:
CouplingTable (size 20×20)
    A     R     N     D     C     Q     E     G     H     I     L     K     M     F     P     S     T     W     Y     V     
A   0.938 0.449 0.528 0.688 0.679 0.519 0.824 0.842 0.319 0.227 0.999 0.678 0.527 0.723 0.686 0.656 0.441 0.390 0.678 0.652 
R   0.916 0.699 0.749 0.835 0.665 0.459 0.873 0.999 0.256 0.773 0.863 0.967 0.533 0.552 0.592 0.955 0.671 0.811 0.744 0.318 
N   0.999 0.446 0.702 0.564 0.999 0.813 0.700 0.999 0.473 0.973 0.999 0.759 0.806 0.877 0.878 0.686 0.802 0.651 0.806 0.786 
D   0.804 0.541 0.962 0.999 0.748 0.894 0.623 0.999 0.661 0.709 0.876 0.784 0.767 0.958 0.740 0.784 0.952 0.614 0.999 0.999 
C   0.601 0.908 0.432 0.797 0.477 0.716 0.623 0.393 0.992 0.762 0.898 0.999 0.973 0.834 0.938 0.748 0.411 0.530 0.611 0.999 
Q   0.558 0.534 0.712 0.395 0.767 0.414 0.999 0.999 0.272 0.866 0.310 0.476 0.655 0.999 0.351 0.826 0.707 0.723 0.767 0.679 
E   0.812 0.613 0.855 0.999 0.748 0.189 0.607 0.906 0.459 0.713 0.630 0.878 0.999 0.932 0.351 0.934 0.636 0.645 0.528 0.376 
G   0.626 0.739 0.736 0.718 0.999 0.999 0.289 0.920 0.001 0.999 0.993 0.999 0.982 0.999 0.999 0.952 0.987 0.563 0.832 0.999 
H   0.781 0.394 0.519 0.320 0.573 0.119 0.712 0.894 0.321 0.960 0.909 0.903 0.610 0.624 0.251 0.840 0.729 0.856 0.541 0.489 
I   0.683 0.645 0.653 0.920 0.999 0.825 0.999 0.769 0.999 0.652 0.680 0.607 0.602 0.581 0.575 0.839 0.633 0.791 0.137 0.759 
L   0.814 0.669 0.669 0.478 0.687 0.823 0.999 0.584 0.122 0.705 0.491 0.710 0.656 0.999 0.733 0.892 0.409 0.380 0.496 0.655 
K   0.945 0.692 0.690 0.839 0.867 0.610 0.999 0.620 0.447 0.491 0.659 0.514 0.661 0.733 0.493 0.702 0.616 0.674 0.680 0.923 
M   0.831 0.856 0.128 0.494 0.741 0.356 0.538 0.763 0.339 0.477 0.582 0.774 0.456 0.517 0.736 0.779 0.531 0.510 0.646 0.905 
F   0.761 0.475 0.419 0.951 0.685 0.442 0.518 0.707 0.174 0.290 0.725 0.678 0.993 0.627 0.516 0.720 0.548 0.705 0.466 0.484 
P   0.508 0.996 0.340 0.999 0.272 0.999 0.999 0.978 0.900 0.927 0.699 0.995 0.999 0.999 0.710 0.998 0.999 0.999 0.999 0.909 
S   0.999 0.611 0.691 0.868 0.506 0.671 0.937 0.940 0.431 0.769 0.911 0.914 0.406 0.951 0.555 0.410 0.785 0.812 0.551 0.716 
T   0.702 0.876 0.995 0.977 0.728 0.999 0.436 0.999 0.974 0.653 0.477 0.863 0.827 0.900 0.999 0.713 0.891 0.641 0.999 0.497 
W   0.999 0.755 0.655 0.556 0.776 0.059 0.685 0.999 0.442 0.571 0.739 0.999 0.471 0.976 0.491 0.745 0.001 0.698 0.741 0.999 
Y   0.812 0.856 0.595 0.811 0.762 0.358 0.847 0.708 0.450 0.989 0.708 0.881 0.791 0.632 0.815 0.369 0.001 0.622 0.771 0.276 
V   0.354 0.595 0.705 0.919 0.999 0.403 0.207 0.999 0.185 0.516 0.999 0.722 0.402 0.595 0.816 0.969 0.886 0.647 0.141 0.957 


Change in coupling probabilities (Δ = updated - prior):
CouplingTable (size 20×20)
    A     R     N     D     C     Q     E     G     H     I     L     K     M     F     P     S     T     W     Y     V     
A   0.349 0.051 0.005 0.039 0.008 0.019 0.258 0.033 0.181 0.190 0.289 0.012 0.140 0.123 0.001 0.183 0.170 0.276 0.010 0.014 
R   0.186 0.163 0.035 0.004 0.132 0.384 0.140 0.185 0.119 0.011 0.152 0.173 0.033 0.059 0.054 0.241 0.100 0.011 0.107 0.126 
N   0.082 0.277 0.139 0.120 0.110 0.029 0.089 0.142 0.027 0.084 0.058 0.045 0.028 0.210 0.011 0.097 0.231 0.016 0.079 0.000 
D   0.005 0.248 0.176 0.124 0.081 0.048 0.334 0.093 0.061 0.003 0.037 0.101 0.161 0.231 0.197 0.092 0.327 0.052 0.332 0.135 
C   0.001 0.108 0.435 0.060 0.323 0.002 0.127 0.007 0.159 0.096 0.086 0.210 0.023 0.084 0.250 0.105 0.144 0.030 0.014 0.213 
Q   0.013 0.022 0.025 0.248 0.101 0.015 0.277 0.135 0.103 0.366 0.448 0.238 0.011 0.332 0.333 0.201 0.071 0.152 0.067 0.108 
E   0.098 0.067 0.045 0.210 0.033 0.538 0.171 0.106 0.141 0.037 0.005 0.253 0.249 0.182 0.470 0.110 0.156 0.213 0.100 0.074 
G   0.266 0.211 0.046 0.075 0.216 0.230 0.438 0.114 0.454 0.293 0.193 0.160 0.082 0.110 0.187 0.237 0.387 0.229 0.073 0.230 
H   0.052 0.106 0.118 0.347 0.093 0.281 0.076 0.016 0.079 0.210 0.034 0.020 0.010 0.043 0.349 0.340 0.105 0.001 0.126 0.089 
I   0.250 0.312 0.014 0.280 0.124 0.296 0.249 0.044 0.332 0.048 0.053 0.219 0.030 0.081 0.025 0.043 0.095 0.009 0.720 0.259 
L   0.100 0.143 0.026 0.315 0.098 0.216 0.264 0.094 0.262 0.038 0.152 0.095 0.177 0.110 0.126 0.085 0.042 0.074 0.304 0.008 
K   0.203 0.015 0.024 0.099 0.034 0.006 0.280 0.060 0.047 0.009 0.104 0.108 0.089 0.045 0.313 0.148 0.037 0.076 0.013 0.538 
M   0.053 0.056 0.706 0.256 0.059 0.310 0.062 0.015 0.261 0.023 0.054 0.024 0.211 0.072 0.064 0.379 0.041 0.204 0.091 0.155 
F   0.009 0.080 0.308 0.094 0.115 0.273 0.149 0.007 0.160 0.123 0.138 0.122 0.160 0.055 0.183 0.092 0.119 0.095 0.034 0.016 
P   0.442 0.046 0.610 0.049 0.678 0.049 0.049 0.028 0.050 0.023 0.251 0.045 0.049 0.049 0.240 0.048 0.049 0.049 0.049 0.041 
S   0.183 0.003 0.119 0.011 0.307 0.043 0.113 0.058 0.269 0.082 0.062 0.236 0.294 0.186 0.307 0.347 0.193 0.257 0.049 0.011 
T   0.012 0.098 0.352 0.131 0.035 0.099 0.051 0.142 0.141 0.019 0.232 0.196 0.049 0.000 0.129 0.037 0.225 0.016 0.332 0.060 
W   0.110 0.005 0.060 0.044 0.109 0.566 0.018 0.142 0.141 0.071 0.025 0.199 0.479 0.026 0.080 0.089 0.249 0.135 0.059 0.249 
Y   0.006 0.027 0.111 0.012 0.096 0.180 0.035 0.061 0.407 0.211 0.029 0.017 0.066 0.083 0.037 0.381 0.384 0.022 0.021 0.489 
V   0.555 0.065 0.045 0.022 0.124 0.052 0.319 0.260 0.148 0.166 0.262 0.009 0.098 0.071 0.028 0.273 0.307 0.153 0.259 0.220 

  Max increase: 0.7202
  Max decrease: 0.0002
  Number with |Δ| > 0.05: 280

6. Use updated coupling table for new predictions

Predicting synthesis for: CRANKYMEGAFISHSTINGRAY
Original coupling probabilities:
Top 10 predicted sequences:
   1.                      Y  Count:    38  Prob: 0.0038  Mass: 181.07 Da
   2.                  INRAY  Count:    28  Prob: 0.0028  Mass: 635.34 Da
   3.                  NGRAY  Count:    26  Prob: 0.0026  Mass: 579.28 Da
   4.                    RAY  Count:    26  Prob: 0.0026  Mass: 408.21 Da
   5.                     AY  Count:    26  Prob: 0.0026  Mass: 252.11 Da
   6.                 INGRAY  Count:    19  Prob: 0.0019  Mass: 692.36 Da
   7.                   NRAY  Count:    18  Prob: 0.0018  Mass: 522.26 Da
   8.                   GRAY  Count:    17  Prob: 0.0017  Mass: 465.23 Da
   9.                TINGRAY  Count:    17  Prob: 0.0017  Mass: 793.41 Da
  10.                   NGRY  Count:    15  Prob: 0.0015  Mass: 508.24 Da

Updated coupling probabilities:
Top 10 predicted sequences:
   1.                  NGRAY  Count:    54  Prob: 0.0054  Mass: 579.28 Da
   2.                      Y  Count:    30  Prob: 0.0030  Mass: 181.07 Da
   3.                   GRAY  Count:    27  Prob: 0.0027  Mass: 465.23 Da
   4.                    RAY  Count:    27  Prob: 0.0027  Mass: 408.21 Da
   5.                     AY  Count:    25  Prob: 0.0025  Mass: 252.11 Da
   6.                   NGRY  Count:    23  Prob: 0.0023  Mass: 508.24 Da
   7.                 INGRAY  Count:    23  Prob: 0.0023  Mass: 692.36 Da
   8.                     RY  Count:    20  Prob: 0.0020  Mass: 337.18 Da
   9.                  INRAY  Count:    18  Prob: 0.0018  Mass: 635.34 Da
  10.             IHSTINGRAY  Count:    18  Prob: 0.0018  Mass: 1130.58 Da

Predicting synthesis for: FISH
Original coupling probabilities:
Top 10 predicted sequences:
   1.  ISH  Count:  5062  Prob: 0.5062  Mass: 355.19 Da
   2.   IH  Count:  2190  Prob: 0.2190  Mass: 268.15 Da
   3. FISH  Count:  1033  Prob: 0.1033  Mass: 502.25 Da
   4.   SH  Count:   696  Prob: 0.0696  Mass: 242.10 Da
   5.  FIH  Count:   476  Prob: 0.0476  Mass: 415.22 Da
   6.    H  Count:   333  Prob: 0.0333  Mass: 155.07 Da
   7.  FSH  Count:   150  Prob: 0.0150  Mass: 389.17 Da
   8.   FH  Count:    60  Prob: 0.0060  Mass: 302.14 Da

Updated coupling probabilities:
Top 10 predicted sequences:
   1.   IH  Count:  3365  Prob: 0.3365  Mass: 268.15 Da
   2.  ISH  Count:  2560  Prob: 0.2560  Mass: 355.19 Da
   3.  FIH  Count:  1395  Prob: 0.1395  Mass: 415.22 Da
   4. FISH  Count:  1035  Prob: 0.1035  Mass: 502.25 Da
   5.    H  Count:   652  Prob: 0.0652  Mass: 155.07 Da
   6.   SH  Count:   529  Prob: 0.0529  Mass: 242.10 Da
   7.   FH  Count:   261  Prob: 0.0261  Mass: 302.14 Da
   8.  FSH  Count:   203  Prob: 0.0203  Mass: 389.17 Da

7. Save observations to JSON for later use
Saved observations to example_observations.json

Loading observations from JSON...
Loaded 3 observations

======================================================================
Example workflow complete!
======================================================================
